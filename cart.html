<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="theme-color" content="#2C1B4A"/>
  <title>Cart ‚Äî Snehvastra</title>
  <meta name="description" content="Snehvastra live inventory, NFC verified cart."/>

  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Clash+Display:wght@400;500;600;700;900&family=Poppins:wght@200;300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet"/>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

  <style>
    :root{
      --amethyst:#2C1B4A; --amethyst-light:#4A377A; --rose-gold:#E8B4B8; --rose-gold-dark:#D4A5AF;
      --pearl:#F8F6F9; --sage:#A8B5A2; --success:#10B981; --shadow-soft:0 20px 60px rgba(44,27,74,0.15);
      --radius:24px; --max-width:1200px; --ease:cubic-bezier(0.32,0.72,0,1);
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#F8F6F9 0%,#EDE8F5 100%);color:var(--amethyst);overflow-x:hidden;line-height:1.6;position:relative;min-height:100vh;-webkit-text-size-adjust:100%;}

    /* ‚úÖ TRUE MOBILE HEADER - 60px FIXED */
    header{position:fixed;top:0;left:0;right:0;z-index:1000;background:rgba(248,246,249,0.98);backdrop-filter:blur(20px);border-bottom:1px solid rgba(44,27,74,0.1);padding:12px 16px;}
    .header-inner{display:flex;align-items:center;justify-content:space-between;min-height:60px;max-width:1200px;margin:0 auto;}
    .brand{display:flex;gap:12px;align-items:center;cursor:pointer;flex-shrink:0;}
    .logo{height:44px;border-radius:12px;box-shadow:0 8px 24px rgba(44,27,74,0.15);}
    nav ul{display:flex;gap:4px;list-style:none;margin:0;padding:0;align-items:center;flex-wrap:wrap;}
    nav a{padding:8px 16px;border-radius:16px;font-weight:500;color:var(--amethyst);text-decoration:none;font-size:0.85rem;transition:all 0.3s ease;white-space:nowrap;display:flex;align-items:center;}
    nav a.active,nav a:hover{background:rgba(232,180,184,0.2);color:var(--amethyst);}
    
    .mobile-nav{display:flex;align-items:center;gap:8px;}
    .search-btn,.hamburger{background:none;border:none;font-size:1.4rem;color:var(--amethyst);cursor:pointer;padding:8px;border-radius:16px;transition:all 0.3s ease;display:flex;align-items:center;justify-content:center;min-width:44px;min-height:44px;}
    .search-btn:hover,.hamburger:hover{background:rgba(44,27,74,0.1);}

    /* ‚úÖ MOBILE ONLY - HIDE DESKTOP NAV */
    @media(max-width:900px){
      nav{display:none;}
      header.menu-open nav{display:flex;flex-direction:column;position:absolute;top:100%;left:0;right:0;background:rgba(248,246,249,0.98);backdrop-filter:blur(20px);border-top:1px solid rgba(44,27,74,0.1);padding:20px 16px;border-radius:0 0 20px 20px;}
      header.menu-open nav ul{flex-direction:column;width:100%;gap:12px;}
      nav a{display:block;text-align:center;padding:16px;width:100%;border-radius:16px;font-size:0.95rem;}
      .logo{height:40px;}
    }

    /* ‚úÖ FIXED AUCTION BANNER */
    .auction-banner{position:fixed;top:76px;right:20px;z-index:900;max-width:220px;background:linear-gradient(135deg,var(--rose-gold),var(--rose-gold-dark));color:var(--amethyst);padding:16px 24px;border-radius:20px;font-family:'Clash Display',serif;font-weight:700;font-size:clamp(0.95rem,2.8vw,1.1rem);text-align:center;box-shadow:var(--shadow-soft);border:1px solid rgba(44,27,74,0.1);}
    @media(max-width:768px){.auction-banner{top:72px;right:16px;max-width:200px;}}
    @media(max-width:480px){.auction-banner{top:68px;right:12px;max-width:170px;}}
    .auction-timer{font-size:clamp(1.2rem,4vw,1.5rem);font-weight:900;color:var(--amethyst);display:block;margin-top:4px;}

    /* ‚úÖ MOBILE HERO */
    .hero{position:relative;margin:76px auto 60px;padding:clamp(60px,15vw,100px) clamp(16px,5vw,5%);text-align:center;background:var(--pearl);backdrop-filter:blur(30px);border-radius:var(--radius);box-shadow:var(--shadow-soft);border:1px solid rgba(44,27,74,0.1);}
    .hero-title{font-family:'Clash Display',serif;font-size:clamp(2.2rem,8vw,4.5rem);background:linear-gradient(135deg,var(--amethyst),var(--amethyst-light));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin:0 0 20px;font-weight:900;letter-spacing:-0.8px;}
    .hero-subtitle{font-size:clamp(1rem,3vw,1.3rem);color:var(--amethyst);opacity:0.8;max-width:90%;margin:0 auto 40px;line-height:1.6;}
    .cart-stats{display:flex;gap:clamp(12px,4vw,48px);justify-content:center;flex-wrap:wrap;}
    @media(max-width:480px){.cart-stats{flex-direction:column;align-items:center;gap:16px;}}
    .stat{background:var(--pearl);backdrop-filter:blur(20px);padding:clamp(20px,5vw,36px) clamp(24px,6vw,48px);border-radius:20px;border:1px solid rgba(44,27,74,0.1);text-align:center;box-shadow:var(--shadow-soft);flex:1;min-width:clamp(120px,25vw,180px);}
    .stat-value{font-family:'Clash Display',serif;font-size:clamp(1.8rem,6vw,2.5rem);font-weight:900;color:var(--amethyst);display:block;margin-bottom:8px;}
    .stat-label{font-size:clamp(0.85rem,2.5vw,1rem);font-weight:400;opacity:0.8;text-transform:uppercase;letter-spacing:0.2px;}

    /* ‚úÖ MOBILE CART GRID */
    .cart-grid{max-width:var(--max-width);margin:0 auto clamp(40px,10vh,140px);padding:0 clamp(16px,5vw,5%);display:flex;flex-direction:column;gap:clamp(40px,10vw,100px);}
    @media(min-width:1100px){.cart-grid{display:grid;grid-template-columns:1fr 400px;gap:clamp(60px,15vw,100px);}}

    /* ‚úÖ MOBILE CART ITEMS */
    .cart-items{background:var(--pearl);backdrop-filter:blur(30px);border-radius:var(--radius);padding:clamp(40px,10vw,80px);box-shadow:var(--shadow-soft);border:1px solid rgba(44,27,74,0.1);}
    .cart-title{font-family:'Clash Display',serif;font-size:clamp(1.8rem,6vw,2.8rem);color:var(--amethyst);margin:0 0 clamp(32px,8vw,56px);text-align:center;font-weight:900;letter-spacing:-0.4px;}
    .cart-header{display:none;}
    @media(min-width:768px){.cart-header{display:grid;grid-template-columns:80px 1fr auto auto 120px;gap:24px;align-items:center;padding:24px 0;font-size:1rem;font-weight:600;color:var(--amethyst);opacity:0.7;border-bottom:2px solid rgba(44,27,74,0.1);margin-bottom:32px;}}
    
    .cart-item{display:flex;flex-direction:column;gap:16px;padding:clamp(24px,6vw,40px) 0;border-bottom:1px solid rgba(44,27,74,0.05);transition:all 0.3s ease;}
    .cart-item:last-child{border-bottom:none;}
    .cart-item:hover{background:rgba(232,180,184,0.04);}
    @media(min-width:768px){.cart-item{display:grid;grid-template-columns:80px 1fr auto auto 120px;gap:24px;align-items:center;flex-direction:row;}}
    @media(max-width:768px){.cart-price{display:none;}}

    .cart-img{width:clamp(64px,18vw,72px);height:clamp(64px,18vw,72px);border-radius:16px;overflow:hidden;box-shadow:0 12px 32px rgba(44,27,74,0.15);}
    .cart-img img{width:100%;height:100%;object-fit:cover;}
    
    .cart-info h4{font-family:'Clash Display',serif;font-size:clamp(1.2rem,4vw,1.5rem);color:var(--amethyst);margin:0 0 8px;font-weight:900;line-height:1.2;}
    .cart-meta{font-size:clamp(0.9rem,2.8vw,1rem);color:var(--amethyst);opacity:0.65;line-height:1.5;}
    .cart-nfc-badge{background:var(--success);color:#fff;padding:6px 12px;border-radius:20px;font-size:0.8rem;font-weight:700;text-transform:uppercase;letter-spacing:0.3px;}
    
    .cart-qty{display:flex;align-items:center;justify-content:center;gap:12px;background:var(--pearl);padding:12px 20px;border-radius:20px;border:1px solid rgba(44,27,74,0.1);}
    .qty-btn{width:40px;height:40px;border-radius:50%;border:none;background:linear-gradient(135deg,var(--amethyst),var(--amethyst-light));color:var(--pearl);font-weight:900;font-size:1.2rem;cursor:pointer;transition:all 0.3s ease;}
    .qty-btn:hover{transform:scale(1.05);}
    .qty-value{font-weight:700;font-size:1.1rem;color:var(--amethyst);min-width:32px;text-align:center;}
    
    .cart-price{font-family:'Clash Display',serif;font-size:clamp(1.2rem,4vw,1.4rem);font-weight:900;color:var(--amethyst);}
    .cart-total{font-family:'Clash Display',serif;font-size:clamp(1.3rem,4.5vw,1.6rem);font-weight:900;color:var(--amethyst);}
    
    .cart-remove{width:36px;height:36px;border-radius:50%;border:none;background:rgba(44,27,74,0.1);color:var(--amethyst);font-size:1.2rem;font-weight:900;cursor:pointer;transition:all 0.3s ease;display:flex;align-items:center;justify-content:center;margin-left:auto;}
    .cart-remove:hover{background:var(--rose-gold);transform:scale(1.1) rotate(90deg);}

    /* ‚úÖ MOBILE SUMMARY */
    .cart-summary{background:var(--pearl);backdrop-filter:blur(40px);border-radius:var(--radius);padding:clamp(40px,10vw,80px);box-shadow:var(--shadow-soft);border:1px solid rgba(44,27,74,0.1);position:sticky;top:clamp(80px,20vh,160px);}
    @media(max-width:1100px){.cart-summary{position:relative;top:auto;}}
    .summary-title{font-family:'Clash Display',serif;font-size:clamp(1.6rem,5vw,2.4rem);color:var(--amethyst);margin:0 0 clamp(32px,8vw,56px);text-align:center;font-weight:900;letter-spacing:-0.2px;}
    .summary-item{display:flex;justify-content:space-between;padding:clamp(20px,5vw,32px) 0;font-size:clamp(1rem,3vw,1.2rem);border-bottom:1px solid rgba(44,27,74,0.1);transition:all 0.3s ease;}
    .summary-item:last-child{border-bottom:none;}
    .summary-label{font-weight:600;color:var(--amethyst);opacity:0.8;}
    .summary-value{font-family:'Clash Display',serif;font-size:clamp(1.2rem,4vw,1.5rem);font-weight:900;color:var(--amethyst);}
    .summary-total{background:linear-gradient(135deg,rgba(107,90,207,0.05),rgba(232,180,184,0.05));padding:clamp(32px,8vw,48px);border-radius:20px;margin-top:clamp(24px,6vw,40px);border:2px solid rgba(44,27,74,0.15);}
    .total-label{font-family:'Clash Display',serif;font-size:clamp(1rem,3vw,1.3rem);font-weight:700;color:var(--amethyst);opacity:0.7;margin-bottom:12px;text-transform:uppercase;letter-spacing:0.2px;}
    .total-amount{font-family:'Clash Display',serif;font-size:clamp(2.2rem,8vw,3.8rem);font-weight:900;background:linear-gradient(135deg,var(--amethyst),var(--amethyst-light));-webkit-background-clip:text;-webkit-text-fill-color:transparent;line-height:1;}
    
    .checkout-btn{width:100%;padding:clamp(20px,5vw,36px);border:none;border-radius:24px;background:linear-gradient(135deg,var(--amethyst),var(--amethyst-light));color:var(--pearl);font-family:'Clash Display',serif;font-size:clamp(1.1rem,3.5vw,1.6rem);font-weight:900;cursor:pointer;box-shadow:var(--shadow-soft);transition:all 0.4s var(--ease);min-height:60px;margin-top:24px;text-transform:uppercase;letter-spacing:0.3px;}
    .checkout-btn:hover{transform:translateY(-4px);box-shadow:0 25px 80px rgba(44,27,74,0.25);}
    .checkout-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none;background:var(--amethyst);}
    
    .continue-btn{width:100%;padding:clamp(16px,4vw,24px);border-radius:20px;border:2px solid rgba(44,27,74,0.2);background:var(--pearl);font-family:'Clash Display',serif;font-weight:700;font-size:clamp(1rem,3vw,1.2rem);color:var(--amethyst);cursor:pointer;transition:all 0.3s var(--ease);margin-top:16px;}
    .continue-btn:hover{background:rgba(44,27,74,0.05);transform:translateY(-2px);}

    /* ‚úÖ EMPTY STATE */
    .empty-cart{text-align:center;padding:clamp(80px,20vh,140px) clamp(40px,10vw,60px);color:var(--amethyst);opacity:0.6;}
    .empty-title{font-family:'Clash Display',serif;font-size:clamp(2.2rem,8vw,3.8rem);color:var(--amethyst);margin:0 0 24px;font-weight:900;letter-spacing:-0.8px;}
    .empty-subtitle{font-size:clamp(1.1rem,3.5vw,1.3rem);margin:0 0 40px;line-height:1.6;opacity:0.8;}

    footer{padding:clamp(60px,15vh,140px) clamp(16px,5vw,5%) clamp(40px,10vh,80px);text-align:center;background:var(--pearl);color:var(--sage);border-top:1px solid rgba(44,27,74,0.1);font-size:clamp(0.85rem,2.5vw,0.95rem);font-weight:300;}
    .footer-links{display:flex;flex-wrap:wrap;justify-content:center;gap:12px;margin-top:20px;}
    .footer-links a{color:var(--amethyst);text-decoration:none;font-weight:500;font-size:clamp(0.85rem,2.5vw,0.9rem);padding:8px 16px;border-radius:16px;transition:all 0.3s ease;}
    .footer-links a:hover{background:rgba(232,180,184,0.2);}

    #toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(100px);background:linear-gradient(135deg,var(--rose-gold),var(--rose-gold-dark));color:var(--amethyst);padding:clamp(14px,4vw,24px) clamp(32px,8vw,48px);border-radius:20px;font-family:'Clash Display',serif;font-weight:700;font-size:clamp(0.95rem,2.8vw,1.1rem);z-index:10000;transition:all 0.4s var(--ease);max-width:90vw;box-shadow:var(--shadow-soft);text-align:center;}
    #toast.show{transform:translateX(-50%) translateY(0);}

    @keyframes float-gentle{0%,100%{transform:translateX(-50%) translateY(0);}50%{transform:translateX(-50%) translateY(-6px);}}
  </style>
</head>
<body>
  <!-- ‚úÖ PERFECT MOBILE HEADER -->
  <header>
    <div class="header-inner">
      <div class="brand" onclick="location.href='index.html'">
        <img src="images/logo.final.png" class="logo" alt="Snehvastra"/>
        <span style="font-family:'Clash Display',serif;font-size:1.1rem;font-weight:600;color:var(--amethyst);">Snehvastra</span>
      </div>
      <nav>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="collection.html">Collection</a></li>
          <li><a href="blog.html">Stories</a></li>
          <li><a href="auction.html">Auction</a></li>
          <li><a href="cart.html" class="active">Cart (<span id="cartCount">0</span>)</a></li>
          <li id="authArea"></li>
        </ul>
      </nav>
      <div class="mobile-nav">
        <button class="search-btn" id="searchBtn">üîç</button>
        <button class="hamburger" id="hamburgerBtn">‚ò∞</button>
      </div>
    </div>
  </header>

  <!-- ‚úÖ FIXED AUCTION BANNER -->
  <div class="auction-banner" id="auctionBanner">
    üî• KOTA ONE AUCTION<br>
    <span class="auction-timer" id="auctionTimer">Loading...</span>
  </div>

  <!-- ‚úÖ HERO -->
  <section class="hero" data-aos="fade-in">
    <h1 class="hero-title" data-aos="fade-up" data-aos-delay="200">Your Collection</h1>
    <p class="hero-subtitle" data-aos="fade-up" data-aos-delay="400">Live inventory ‚Ä¢ NFC verified ‚Ä¢ Collector pricing</p>
    <div class="cart-stats">
      <div class="stat" data-aos="fade-up" data-aos-delay="100">
        <div style="font-size:clamp(1.8rem,6vw,2.5rem);font-weight:900;color:var(--amethyst);" id="heroItems">0</div>
        <div>Items</div>
      </div>
      <div class="stat" data-aos="fade-up" data-aos-delay="200">
        <div style="font-size:clamp(1.8rem,6vw,2.5rem);font-weight:900;color:var(--amethyst);" id="heroTotal">‚Çπ0</div>
        <div>Total</div>
      </div>
      <div class="stat" data-aos="fade-up" data-aos-delay="300">
        <div style="font-size:clamp(1.8rem,6vw,2.5rem);font-weight:900;color:var(--success);">‚úì</div>
        <div>NFC Ready</div>
      </div>
    </div>
  </section>

  <div class="cart-grid">
    <!-- ‚úÖ CART ITEMS -->
    <section class="cart-items" data-aos="fade-right">
      <h2 class="cart-title" data-aos="fade-up">Selected Pieces</h2>
      
      <div class="cart-header" data-aos="fade-up" data-aos-delay="100">
        <span></span>
        <span>Piece Details</span>
        <span>Unit</span>
        <span>Price</span>
        <span>Total</span>
      </div>
      
      <div id="cartItems"></div>
      
      <div id="emptyCart" class="empty-cart" style="display:none;">
        <h2 class="empty-title" data-aos="zoom-in">Empty Cart</h2>
        <p class="empty-subtitle" data-aos="fade-up" data-aos-delay="200">Your collection is waiting. Discover latest drops.</p>
        <a href="collection.html" class="continue-btn" data-aos="fade-up" data-aos-delay="400">Explore Collection</a>
      </div>
    </section>

    <!-- ‚úÖ SUMMARY -->
    <aside class="cart-summary" data-aos="fade-left">
      <h2 class="summary-title">Collector Summary</h2>
      
      <div class="summary-item">
        <span class="summary-label">Subtotal</span>
        <span class="summary-value" id="subtotal">‚Çπ0</span>
      </div>
      <div class="summary-item">
        <span class="summary-label">Shipping</span>
        <span class="summary-value" id="shipping">‚Çπ0</span>
      </div>
      <div class="summary-item">
        <span class="summary-label">GST (18%)</span>
        <span class="summary-value" id="tax">‚Çπ0</span>
      </div>
      
      <div class="summary-total">
        <div class="total-label">Grand Total</div>
        <div class="total-amount" id="grandTotal">‚Çπ0</div>
      </div>
      
      <div style="font-size:clamp(0.9rem,2.8vw,1rem);color:var(--amethyst);opacity:0.7;margin-top:24px;line-height:1.5;text-align:center;">
        Free shipping above ‚Çπ50K ‚Ä¢ NFC included
      </div>
      
      <button class="checkout-btn" id="checkoutBtn" disabled>Secure Checkout</button>
      <button class="continue-btn" onclick="location.href='collection.html'">Continue Shopping</button>
    </aside>
  </div>

  <!-- ‚úÖ FOOTER -->
  <footer>
    ¬© <span id="year"></span> Snehvastra. Kota Studio ‚Ä¢ NFC Authenticated.
    <div class="footer-links">
      <a href="nfc-story.html">NFC Story</a>
      <a href="terms.html">Terms</a>
      <a href="privacy.html">Privacy</a>
    </div>
  </footer>

  <div id="toast"></div>

  <script>
    // ‚úÖ BULLETPROOF MOBILE CART SYSTEM (üîß SNEHVASTRA MOBILE LOCK)
    (function(){
      const USER_KEY = "snehvastra_user"; 
      const CART_KEY = "snehvastra_cart";
      let cart = {}, user = null;

      function safeGet(key, fallback) {
        try {
          return JSON.parse(localStorage.getItem(key) || fallback);
        } catch(e) {
          return fallback;
        }
      }

      const PRODUCT_DB = {
        "signature-tee": {name:"Signature Tee Black",price:4999,image:"images/products/tee.jpg",nfc:true,stock:12},
        "cloud-hoodie": {name:"Cloud Hoodie Indigo",price:19999,image:"images/products/hoodie.jpg",nfc:true,stock:8},
        "midnight-jacket": {name:"Midnight Jacket",price:29999,image:"images/products/jacket.jpg",nfc:true,stock:5},
        "snehvastra-one": {name:"Snehvastra ONE 1/1",price:125000,image:"images/products/one.jpg",nfc:true,stock:1,auction:true}
      };

      window.renderAuth = function(){
        const authArea = document.getElementById("authArea");
        if(!authArea) return;
        user = safeGet(USER_KEY, null);
        if(user && user.loggedIn) {
          authArea.innerHTML = `<span style="color:var(--rose-gold);font-weight:600;font-family:'Clash Display',serif;font-size:0.85rem;">Hi, ${user.name?.split(' ')[0]}</span>`;
        } else {
          authArea.innerHTML = `<a href="user-login.html" style="padding:8px 16px;border:2px solid var(--rose-gold);color:var(--rose-gold);border-radius:16px;font-weight:500;font-size:0.8rem;">Login</a>`;
        }
      };

      function updateCartCount(){
        const total = Object.values(cart).reduce((a,b)=>a+(b||0),0);
        const cartEl = document.getElementById("cartCount");
        if(cartEl) cartEl.textContent = total || 0;
        document.getElementById("heroItems").textContent = total || 0;
      }

      function money(n){return "‚Çπ" + Math.round(Number(n)).toLocaleString("en-IN");}

      function showToast(msg) {
        const toast = document.getElementById("toast");
        if(toast){
          toast.textContent = msg;
          toast.classList.add("show");
          setTimeout(()=>toast.classList.remove("show"), 3000);
        }
      }

      // MOBILE MENU
      document.getElementById("hamburgerBtn")?.addEventListener("click", ()=>{
        document.querySelector("header").classList.toggle("menu-open");
      });

      // RENDER SUMMARY
      function renderSummary(){
        const itemsEl = document.getElementById("cartItems");
        itemsEl.innerHTML = "";
        
        let subtotal = 0;
        const activeItems = Object.entries(cart).filter(([id,qty]) => qty > 0 && PRODUCT_DB[id]);
        
        if(activeItems.length === 0){
          document.getElementById("emptyCart").style.display = "block";
          document.getElementById("checkoutBtn").disabled = true;
          renderEmptySummary();
          return;
        }
        
        document.getElementById("emptyCart").style.display = "none";
        document.getElementById("checkoutBtn").disabled = false;

        activeItems.forEach(([id,qty]) => {
          const product = PRODUCT_DB[id];
          const lineTotal = product.price * qty;
          subtotal += lineTotal;
          
          const item = document.createElement("div");
          item.className = "cart-item";
          item.innerHTML = `
            <div class="cart-img">
              <img src="${product.image}" alt="${product.name}" loading="lazy">
            </div>
            <div class="cart-info">
              <h4>${product.name}</h4>
              <div class="cart-meta">
                ${product.nfc ? '<span class="cart-nfc-badge">NFC Verified</span>' : ''} 
                ${product.stock > 0 ? `Stock: ${product.stock}` : 'Limited'}
              </div>
            </div>
            <div class="cart-qty">
              <button class="qty-btn" data-id="${id}" data-action="minus">‚àí</button>
              <span class="qty-value">${qty}</span>
              <button class="qty-btn" data-id="${id}" data-action="plus">+</button>
            </div>
            <div class="cart-price">${money(product.price)}</div>
            <div class="cart-total">${money(lineTotal)}</div>
            <button class="cart-remove" data-id="${id}">√ó</button>
          `;
          itemsEl.appendChild(item);
        });

        const shipping = subtotal >= 50000 ? 0 : 199;
        const tax = Math.round(subtotal * 0.18);
        const grandTotal = subtotal + shipping + tax;

        document.getElementById("subtotal").textContent = money(subtotal);
        document.getElementById("shipping").textContent = shipping ? money(shipping) : "FREE";
        document.getElementById("tax").textContent = money(tax);
        document.getElementById("grandTotal").textContent = money(grandTotal);
        document.getElementById("heroTotal").textContent = money(grandTotal);
      }

      function renderEmptySummary(){
        document.getElementById("subtotal").textContent = "‚Çπ0";
        document.getElementById("shipping").textContent = "‚Çπ0";
        document.getElementById("tax").textContent = "‚Çπ0";
        document.getElementById("grandTotal").textContent = "‚Çπ0";
        document.getElementById("heroTotal").textContent = "‚Çπ0";
      }

      // EVENT DELEGATION
      document.addEventListener("click", (e) => {
        const btn = e.target.closest("button");
        if(!btn || !document.getElementById("cartItems").contains(e.target)) return;
        
        const id = btn.dataset.id;
        if(!id || !PRODUCT_DB[id]) return;
        
        if(btn.classList.contains("qty-btn")){
          const action = btn.dataset.action;
          if(action === "plus"){
            cart[id] = (cart[id] || 0) + 1;
          } else {
            cart[id] = Math.max(0, (cart[id] || 0) - 1);
            if(cart[id] === 0) delete cart[id];
          }
          localStorage.setItem(CART_KEY, JSON.stringify(cart));
          showToast("Updated");
          renderSummary();
          updateCartCount();
        } else if(btn.classList.contains("cart-remove")){
          delete cart[id];
          localStorage.setItem(CART_KEY, JSON.stringify(cart));
          showToast("Removed");
          renderSummary();
          updateCartCount();
        }
      });

      document.getElementById("checkoutBtn").onclick = () => {
        const activeItems = Object.values(cart).filter(qty => qty > 0).length;
        if(activeItems === 0){
          showToast("Add items first");
          return;
        }
        location.href = "checkout.html";
      };

      // AUCTION TIMER
      const auctionEnd = new Date("2025-12-25T18:00:00").getTime();
      function updateAuctionTimer(){
        const diff = auctionEnd - Date.now();
        const timerEl = document.getElementById("auctionTimer");
        if(timerEl && diff > 0){
          const days = Math.floor(diff/(1000*60*60*24));
          const hours = Math.floor((diff%(1000*60*60*24))/(1000*60*60));
          timerEl.textContent = `${days}d ${hours.toString().padStart(2,'0')}h`;
        } else if(timerEl) {
          timerEl.textContent = "LIVE!";
        }
      }

      // INIT
      function init(){
        cart = safeGet(CART_KEY, {});
        renderAuth();
        updateCartCount();
        renderSummary();
        updateAuctionTimer();
        setInterval(updateAuctionTimer, 30000);
        document.getElementById("year").textContent = new Date().getFullYear();
        if(typeof AOS !== 'undefined') AOS.init({duration:800, once:true});
      }

      if(document.readyState === 'loading'){
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
