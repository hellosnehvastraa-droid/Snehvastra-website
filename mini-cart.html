<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<meta name="theme-color" content="#3A0F5A" />
<title>Mini Cart — Snehvastra</title>
<meta name="description" content="Instant luxury preview of your Snehvastra cart." />

<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Clash+Display:wght@500;600&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />

<style>
:root{
  --purple:#3A0F5A; --purple-dark:#2e0b4a;
  --slate:#22232A; --mid:#3B3D45;
  --muted:#8f9095; --paper:#F6F6F6;
  --radius:14px; --ease:.28s; --card:#fff;
}

*{box-sizing:border-box}
body{
  margin:0; background:linear-gradient(180deg,var(--paper),#FBFAF8);
  font-family:'Poppins',sans-serif; color:var(--slate);
  min-height:100vh;
}

/* NAV */
nav{
  position:fixed;
  top:16px;
  width:100%;
  display:flex;
  justify-content:center;
  z-index:200;
}

nav ul{
  list-style:none; display:flex; gap:1.4rem;
  background:rgba(255,255,255,0.96); backdrop-filter:blur(18px);
  border-radius:60px; padding:0.85rem 2rem;
  border:1px solid rgba(58,15,90,0.08);
  box-shadow:0 10px 40px rgba(58,15,90,0.08);
  align-items:center;
}

nav a, .mini-toggle{
  text-decoration:none; color:var(--mid);
  font-weight:600; background:none; border:none;
  cursor:pointer; padding:6px 10px; transition:.25s;
}

nav a:hover, .mini-toggle:hover{color:var(--purple)}

/* BADGE */
#cartCount{
  background:var(--purple); color:#fff; padding:2px 8px;
  border-radius:999px; font-size:.8rem; font-weight:700;
  margin-left:6px;
}

/* MINI CART PANEL */
.mini-cart{
  position:fixed;
  top:86px;
  right:50%;
  transform:translateX(50%) scale(.95);
  width:360px;
  background:rgba(255,255,255,0.98);
  backdrop-filter:blur(20px);
  border-radius:var(--radius);
  box-shadow:0 22px 60px rgba(58,15,90,0.25);
  border:1px solid rgba(58,15,90,0.1);
  opacity:0;
  pointer-events:none;
  transition:all var(--ease);
  z-index:300;
}

.mini-cart.active{
  opacity:1;
  pointer-events:auto;
  transform:translateX(50%) scale(1);
}

@media(max-width:480px){
  .mini-cart{
    width:92vw;
    right:4%;
    transform:scale(.94)
  }
  .mini-cart.active{transform:scale(1)}
}

/* HEADER */
.mini-h{
  background:linear-gradient(135deg,var(--purple),var(--purple-dark));
  padding:1rem; color:#fff; text-align:center;
  font-family:'Clash Display',serif; font-size:1.2rem;
  border-radius:var(--radius) var(--radius) 0 0;
}

/* ITEM LIST */
#cartItems{max-height:260px; overflow-y:auto; padding:1rem}

.cart-line{
  display:flex; align-items:center; gap:14px;
  background:rgba(58,15,90,0.03);
  border:1px solid rgba(58,15,90,0.06);
  padding:12px; border-radius:12px;
  margin-bottom:12px; transition:.25s;
}

.cart-line:hover{
  box-shadow:0 8px 25px rgba(58,15,90,0.1);
  transform:translateY(-2px);
}

.cart-line img{
  width:52px; height:52px;
  border-radius:10px; object-fit:cover;
  border:1px solid rgba(58,15,90,0.1);
}

.details{flex:1}
.details p{margin:0; font-size:.92rem}
.details p:first-child{font-weight:600;color:var(--slate)}
.details p:last-child{color:var(--purple);font-weight:600}

.remove{
  width:32px;height:32px;border-radius:50%;
  background:rgba(0,0,0,0.04); border:none; cursor:pointer;
  font-size:1.3rem; color:var(--muted);
  transition:.25s;
}
.remove:hover{
  background:rgba(224,30,30,0.1);
  color:#e03e3e; transform:scale(1.15);
}

/* TOTAL + CTA */
.total{
  padding:1rem; text-align:center;
  border-top:1px solid rgba(58,15,90,0.1);
  font-weight:700; color:var(--purple-dark);
}

.checkout-btn{
  width:100%; border:none; cursor:pointer;
  padding:1rem; font-family:'Clash Display',serif;
  background:linear-gradient(135deg,var(--purple),var(--purple-dark));
  color:#fff; font-size:1.1rem;
  border-radius:12px; margin-bottom:1rem;
  transition:.3s;
}
.checkout-btn:hover{
  box-shadow:0 12px 42px rgba(58,15,90,0.45);
  transform:translateY(-2px);
}
</style>
</head>

<body>

<nav>
  <ul>
    <li><a href="index.html">Home</a></li>
    <li><a href="collection.html">Collection</a></li>
    <li><a href="faq.html">FAQ</a></li>
    <li><a href="auction.html">Auction</a></li>
    <li>
      <button class="mini-toggle" id="miniToggle" aria-expanded="false">
        Cart <span id="cartCount">0</span>
      </button>

      <!-- MINI CART -->
      <div class="mini-cart" id="miniCart" role="dialog" aria-label="Mini Cart">
        <div class="mini-h">Your Cart</div>
        <div id="cartItems"></div>
        <div class="total" id="cartTotal">Total: ₹0</div>
        <button class="checkout-btn" onclick="location.href='cart.html'">
          Proceed to Checkout →
        </button>
      </div>
    </li>
  </ul>
</nav>

<script>
/****************************************
  CART SYSTEM — UNIVERSAL ENGINE (LOCKED)
****************************************/
const CART_KEY = "snehvastra_cart";

function readCart(){
  try { return JSON.parse(localStorage.getItem(CART_KEY)) || {}; }
  catch { return {}; }
}
function saveCart(c){
  localStorage.setItem(CART_KEY, JSON.stringify(c));
}

function formatINR(n){
  return "₹" + n.toLocaleString("en-IN");
}

const miniCart = document.getElementById("miniCart");
const toggleBtn = document.getElementById("miniToggle");
const countEl = document.getElementById("cartCount");
const itemsEl = document.getElementById("cartItems");
const totalEl = document.getElementById("cartTotal");

function updateMiniCart(){
  const cart = readCart();
  const entries = Object.entries(cart);

  let totalQty = 0;
  let totalPrice = 0;
  itemsEl.innerHTML = "";

  if(entries.length === 0){
    itemsEl.innerHTML =
      `<div style="padding:2rem;text-align:center;color:var(--muted)">Your cart is empty</div>`;
    totalEl.textContent = "Total: ₹0";
    countEl.textContent = 0;
    return;
  }

  for(const [id, data] of entries){
    const { name, price, qty, img } = data;
    totalQty += qty;
    totalPrice += price * qty;

    const div = document.createElement("div");
    div.className = "cart-line";

    div.innerHTML = `
      <img src="${img || 'images/placeholder.png'}" onerror="this.src='images/placeholder.png'">
      <div class="details">
        <p>${name}</p>
        <p>${formatINR(price)} × ${qty}</p>
      </div>
      <button class="remove" aria-label="Remove item">×</button>
    `;

    div.querySelector(".remove").onclick = () => {
      const c = readCart();
      delete c[id];
      saveCart(c);
      updateMiniCart();
    };

    itemsEl.appendChild(div);
  }

  countEl.textContent = totalQty;
  totalEl.textContent = "Total: " + formatINR(totalPrice);
}

/****************************************
  EVENTS
****************************************/
toggleBtn.onclick = () => {
  const show = !miniCart.classList.contains("active");
  miniCart.classList.toggle("active", show);
  toggleBtn.setAttribute("aria-expanded", show);
  if(show) updateMiniCart();
};

document.addEventListener("click", e => {
  if(!miniCart.contains(e.target) && !toggleBtn.contains(e.target)){
    miniCart.classList.remove("active");
    toggleBtn.setAttribute("aria-expanded","false");
  }
});

document.addEventListener("keydown", e => {
  if(e.key === "Escape"){
    miniCart.classList.remove("active");
    toggleBtn.setAttribute("aria-expanded","false");
  }
});

window.addEventListener("load", updateMiniCart);
window.addEventListener("storage", updateMiniCart);
</script>

</body>
</html>
